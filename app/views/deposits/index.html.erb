<div class="deposits_body">

  <div class="resum_deposits col-8">
    <p>Votre dépôt comprend :</p>
     <div class="index-container ">
    <% @products.each do |product| %>

      <div class="cards" >
        <%# <%= cl_image_tag product.picture1.key, class:" rounded-5", height: 150, width: 200, crop: :fill if product.picture1.attached? %>
        <div class="card-body">
          <h4><%= link_to product.title, product_path(product) %></h4>
          <p><%= product.detail %></p>
          <p><%= product.condition %></p>
          <p><%= product.category %></p>
          <p><%= product.price %>€</p>
        </div>
      </div>

    <% end %>
  </div>

    <p>Le total de vos coupons:</p>
    <p> - <%= @total_price %>€ </p>
  </div>


  <div class="reservation_deposits col-2">
    <p>Date de dépôt :</p>
    <p>Vour pouvez effectuer votre dépôt entre le <%= Time.now.strftime("%d/%m/%Y") %> et le <%= (Time.now + 15.days).strftime("%d/%m/%Y") %></p>
    <% if @products.any? { |product| product.establishment_id == 1 } %>
      <p>Dans l'un des établissement suivant :</p>
      <p>Cliquez sur létablissement où vous désirez apporter votre dépot:</p>
      <p>Vos adresses proches de chez vous:</p>
    <% end %>
    <div>
      <% chosen_establishments = [] %>
      <% @establishments.each do |establishment|%>
        <% next if establishment.id == 1 %>
        <% if @products.any? { |product| product.establishment_id == 1 } %>
          <ul>
            <%= button_to establishment.name, confirme_establishment_path(establishment), method: :patch, class: 'btn btn-success' %>
            <%= establishment.address %>
          </ul>
          <% chosen_establishments << establishment %>
        <% end %>
      <% end %>
        <% if chosen_establishments.empty? && @products.any? { |product| product.establishment_id != 1 } %>
          <p>L'établissement que vous avez choisit :</p>
          <%= @products.find { |product| product.establishment_id != 1 }.establishment.name %>
          <%= @products.find { |product| product.establishment_id != 1 }.establishment.address %>
        <% end %>
      </div>
  </div>

  <div class="map_container_deposits col-2">
    <p>insert map</p>
  </div>


  <div class="btn_deposits" id="Valid">
    <%= button_to "Valider",  root_path, class:"btn btn-outline-success" %>
  </div>

  <div class="btn_deposits" id="Retour">
    <%= button_to "Annuler",  root_path, class:"btn btn-outline-success" %>
  </div>


  <div>
     <div style="width: 100%; height: 300px;"
        data-controller="map"
        data-map-markers-value="<%= @marker.to_json %>"
        data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
      </div>
  </div>
</div>
