<div class="deposits_body">

  <div class="resumdepo_deposits col-8 overflow-auto">
    <p>Votre d√©p√¥t comprend :</p>
    <% if @products.any? { |product| product.ticket_id == 1 } %>
      <div class="index-container ">
        <% @products.select {|product| product.ticket_id == 1}.each do |product| %>
          <div class="cards" >
            <%# <%= cl_image_tag product.picture1.key, class:" rounded-5", height: 150, width: 200, crop: :fill if product.picture1.attached? %>
            <div class="card-body">
              <h4><%= link_to product.title, product_path(product) %></h4>
              <p><%= product.detail %></p>
              <p><%= product.condition %></p>
              <p><%= product.category %></p>
              <p><%= product.price %>‚Ç¨</p>
            </div>
            <div>
              <%= button_to "Supprimer", deposit_path(product), method: :delete, data: { confirm: 'Are you sure?' },  class:"btn btn-outline-warning" %>
            </div>
          </div>
       
        <% end %>
      </div>

      <p>Le total de vos coupons:</p>
      <p> - <%= @total_price %>‚Ç¨ </p>

    <% end %>

  </div>
  <div>
    <p>Le total de vos coupons:</p>
    <p> - <%= @total_price %>‚Ç¨ </p>
  </div>


  <div class="reservation_deposits col-2">
    <p>Date de d√©p√¥t :</p>
    <p>Vour pouvez effectuer votre d√©p√¥t entre le <%= Time.now.strftime("%d/%m/%Y") %> et le <%= (Time.now + 15.days).strftime("%d/%m/%Y") %></p>
    <% if @products.any? { |product| product.establishment_id == 1 } %>
      <p>Dans l'un des √©tablissement suivant :</p>
      <p>Cliquez sur l√©tablissement o√π vous d√©sirez apporter votre d√©pot:</p>
      <p>Vos adresses proches de chez vous:</p>
    <% end %>
    <div>

      <% chosen_establishments = [] %>
      <% @establishments.each do |establishment|%>
        <% next if establishment.id == 1 %>
        <% if @products.any? { |product| product.establishment_id == 1 } %>
          <ul>
            <%= button_to establishment.name, confirme_establishment_path(establishment), method: :patch, class: 'btn btn-success' %>
            <%= establishment.address %>
          </ul>
          <% chosen_establishments << establishment %>
        <% end %>
      <% end %>
        <% if chosen_establishments.empty? && @products.any? { |product| product.establishment_id != 1 } %>
          <p>L'√©tablissement que vous avez choisit :</p>
          <%= @products.find { |product| product.establishment_id != 1 }.establishment.name %>
          <%= @products.find { |product| product.establishment_id != 1 }.establishment.address %>
        <% end %>
      </div>
  </div>

  <div class="map_container_deposits col-2">
    <div style="width: 100%; height: 300px;"
      data-controller="map"
      data-map-markers-value="<%= @marker.to_json %>"
      data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
    </div>
  </div>

  <div class="btn_deposits" id="Valid">

    <%= button_to "Valider",  increment_path, method: :post, class:"btn btn-outline-success" %>

  </div>


   <div id="mySidenav" class="sidenav">
    <%= link_to"üì¶ -  D√©p√¥t", new_product_path, method: :get, class: "depot", id:"depot" %><br><br><br>
    <%= link_to "üõí - Achat", "#", method: :get, class:"achat", id:"achat" %>
    <%# <p id="achat"> üõí - Achat</p> %>
    <%# <p href="" id="depot"> üì¶ - D√©p√¥t</p> %>
   </div>

</div>
